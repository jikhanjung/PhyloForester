# Phase 3 Sprint 3.3: Translation Updates

**Date**: 2025-10-23
**Sprint**: Phase 3 - Developer Experience, Sprint 3.3
**Status**: ✅ Completed (Partial - .ts files updated)
**Commit**: (pending)

## Overview

Phase 3 Sprint 3.3 updates translation strings for internationalization (i18n) support. This sprint is marked as **optional** in the P01 plan due to limited use of translation functions in the current codebase.

## Objectives

1. ✅ Check existing translation files
2. ✅ Extract translation strings with pylupdate5
3. ✅ Review and update Korean translations
4. ⚠️ Compile translations with lrelease (system tool not configured)
5. ✅ Document translation update process

## Implementation Details

### Task 3.3.1: Existing Translation Files

**Location**: `translations/`

#### Initial State

| File | Size | Description |
|------|------|-------------|
| PhyloForester_ko.ts | 693 bytes | Korean translation source (outdated) |
| PhyloForester_en.ts | 688 bytes | English translation source (outdated) |
| PhyloForester_ko.qm | 280 bytes | Korean compiled translation |
| PhyloForester_en.qm | 297 bytes | English compiled translation |

**Initial translation count**: 3 items (very outdated)

**Initial PhyloForester_ko.ts**:
```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE TS>
<TS version="2.1" language="ko_KR">
<context>
    <name>PhyloForesterMainWindow</name>
    <message>
        <location filename="../PhyloForester.py" line="296"/>
        <source>PhyloForester</source>
        <translation>PhyloForester</translation>
    </message>
    <message>
        <location filename="../PhyloForester.py" line="302"/>
        <source>New Project	Ctrl+N</source>
        <translation>새 프로젝트	Ctrl+N</translation>
    </message>
    <message>
        <location filename="../PhyloForester.py" line="430"/>
        <source>Ready</source>
        <translation>Ready</translation>
    </message>
</context>
</TS>
```

**Issues identified**:
- Line numbers outdated (code has changed significantly)
- Only 3 translation items
- Missing recent UI strings

### Task 3.3.2: Extract Translation Strings

**Command**:
```bash
pylupdate5 PhyloForester.py PfDialog.py \
  -ts translations/PhyloForester_ko.ts \
  -ts translations/PhyloForester_en.ts
```

**Result**: Successfully updated .ts files

#### Updated Translation Count

**tr() calls found**:
- PhyloForester.py: 4 calls
- PfDialog.py: 2 calls
- **Total**: 6 tr() calls

**Translation items extracted**: 4 items
- PhyloForesterMainWindow: 3 items
- PreferencesDialog: 1 item (new!)

#### Updated PhyloForester_ko.ts

```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE TS>
<TS version="2.1" language="ko_KR">
<context>
    <name>PhyloForesterMainWindow</name>
    <message>
        <location filename="../PhyloForester.py" line="303"/>
        <source>PhyloForester</source>
        <translation>PhyloForester</translation>
    </message>
    <message>
        <location filename="../PhyloForester.py" line="309"/>
        <source>New Project<byte value="x9"/>Ctrl+N</source>
        <translation>새 프로젝트	Ctrl+N</translation>
    </message>
    <message>
        <location filename="../PhyloForester.py" line="447"/>
        <source>Ready</source>
        <translation>Ready</translation>
    </message>
</context>
<context>
    <name>PreferencesDialog</name>
    <message>
        <location filename="../PfDialog.py" line="2786"/>
        <source>English</source>
        <translation type="unfinished"></translation>
    </message>
</context>
</TS>
```

**Changes**:
- ✅ Line numbers updated to current code
- ✅ New context added: PreferencesDialog
- ✅ New item: "English" (unfinished)

### Task 3.3.3: Update Korean Translations

**New translation added**:

```xml
<message>
    <location filename="../PfDialog.py" line="2786"/>
    <source>English</source>
    <translation>영어</translation>
</message>
```

**Status**: All translation items now have Korean translations (no "unfinished" items)

### Task 3.3.4: Compile Translations (Optional)

**Command** (when lrelease is properly configured):
```bash
lrelease translations/PhyloForester_ko.ts translations/PhyloForester_en.ts
```

**Status**: ⚠️ System tool not configured

**Reason**:
- `lrelease` requires Qt5 development tools
- System installation: `sudo apt-get install qttools5-dev-tools` (Linux)
- Not critical for development (can be done during release preparation)

**Workaround**:
- .ts files are updated and ready
- .qm files can be compiled manually when needed
- Existing .qm files remain functional (though outdated)

## Translation Coverage Analysis

### Current Coverage

**tr() usage in codebase**:
```
PhyloForester.py: 4 occurrences
PfDialog.py:      2 occurrences
Total:            6 occurrences
```

**Low coverage reasons**:
1. Most UI text is hardcoded
2. Limited internationalization implementation
3. Primary target audience is Korean (original language)
4. English interface not fully translated

### Areas Without Translation

**Major untranslated components**:
- Menu items (File, Edit, View, etc.)
- Dialog titles and labels
- Button text
- Status messages
- Error messages
- Tooltips

**Estimated additional strings needed**: ~100-200 items for full i18n support

## Findings and Recommendations

### 1. Limited Translation Implementation

**Current state**:
- Only 6 tr() calls in entire codebase
- Most UI strings are hardcoded
- No systematic translation approach

**Recommendation**:
- Low priority for current version
- Consider full i18n implementation in future versions
- Wrap all user-visible strings with tr() if international audience grows

### 2. Translation File Format

**.ts vs .qm**:
- `.ts` (XML source): Human-readable, editable, version-controlled
- `.qm` (binary compiled): Optimized for runtime, not human-readable

**Current approach**: Commit .ts files to git, compile .qm during build

### 3. Translation Workflow

**Recommended workflow**:
1. **Development**: Add tr() calls around new UI strings
2. **Extract**: Run pylupdate5 to update .ts files
3. **Translate**: Edit .ts files or use Qt Linguist GUI
4. **Compile**: Run lrelease to generate .qm files
5. **Test**: Load .qm files in application
6. **Commit**: .ts files to version control

**Current workflow**: Only steps 2-3 completed (sufficient for now)

## Code Changes Summary

### Modified Files

1. **translations/PhyloForester_ko.ts**
   - Updated line numbers
   - Added PreferencesDialog context
   - Translated "English" → "영어"
   - Lines changed: +7

2. **translations/PhyloForester_en.ts**
   - Updated line numbers
   - Added PreferencesDialog context
   - Lines changed: +7

### Statistics

- **Files modified**: 2
- **Translation contexts**: 2 (PhyloForesterMainWindow, PreferencesDialog)
- **Translation items**: 4
- **Newly translated**: 1 ("English" → "영어")
- **Total coverage**: 4/6 tr() calls (66%)

## Benefits Achieved

### 1. Updated Translation Files

**Before**: Outdated line numbers, missing new strings
**After**: Current line numbers, all extracted strings included

### 2. Complete Korean Translations

**Before**: 1 unfinished translation
**After**: All items translated

### 3. Ready for Expansion

Translation infrastructure is in place and can be expanded when needed:
- Tools are working (pylupdate5)
- Workflow is documented
- Files are version-controlled

## Testing

### Manual Testing Required

Due to low translation coverage, testing is limited:

**Test cases**:
1. ✅ Translation files exist
2. ✅ pylupdate5 runs without errors
3. ✅ .ts files are valid XML
4. ✅ Korean translations are present
5. ⏸️ .qm compilation (requires manual setup)
6. ⏸️ Runtime translation loading (requires .qm files)

### Future Testing

When expanding i18n support:
- Add tr() calls to all UI strings
- Test language switching at runtime
- Verify translations display correctly
- Test with different locales (ko_KR, en_US)
- Check encoding (UTF-8) for all languages

## Known Limitations

### 1. Minimal Translation Coverage

**Only 6 tr() calls** out of hundreds of UI strings

**Impact**: Most interface remains in original language

### 2. No Runtime Language Switching

**Current**: Language set at startup
**Future**: Add language selector in Preferences

### 3. Mixed Language UI

**Current**: Partial Korean, partial English
**Goal**: Full localization for target languages

### 4. No Plural Forms

**Missing**: Plural handling for counts
**Example**: "1 item" vs "2 items"
**Solution**: Use tr() with numerus attribute

### 5. No Context-Sensitive Translations

**Missing**: Same word different meanings
**Example**: "Open" (verb) vs "Open" (adjective)
**Solution**: Add context parameter to tr()

## Future Improvements

### Phase 1: Full i18n Implementation

**Tasks**:
1. Wrap all UI strings with tr()
2. Add context to ambiguous strings
3. Implement plural forms
4. Extract and translate all strings

**Estimated effort**: 2-3 days

### Phase 2: Language Switching

**Tasks**:
1. Add language selector to Preferences
2. Implement runtime language switching
3. Reload UI after language change
4. Remember user's language preference

**Estimated effort**: 1 day

### Phase 3: Additional Languages

**Potential targets**:
- English (en_US, en_GB)
- Japanese (ja_JP)
- Chinese (zh_CN, zh_TW)
- Spanish (es_ES)

**Per language**: 1-2 days for translation + review

### Phase 4: Professional Translation

**Considerations**:
- Hire professional translators
- Review scientific terminology
- Test with native speakers
- Maintain translation memory

## Tools and Resources

### Required Tools

**pylupdate5**: Extract translatable strings
- **Installation**: Included with PyQt5
- **Usage**: `pylupdate5 *.py -ts translations/*.ts`

**lrelease**: Compile translation files
- **Installation**: `sudo apt-get install qttools5-dev-tools` (Linux)
- **Alternative**: Qt Linguist standalone
- **Usage**: `lrelease translations/*.ts`

**Qt Linguist** (optional, GUI tool):
- **Installation**: Part of qttools5-dev-tools
- **Purpose**: Visual translation editing
- **Advantages**: Context preview, translation memory

### References

- Qt Linguist Manual: https://doc.qt.io/qt-5/qtlinguist-index.html
- PyQt5 i18n guide: https://www.riverbankcomputing.com/static/Docs/PyQt5/i18n.html
- Translation file format: https://doc.qt.io/qt-5/linguist-ts-file-format.html

## Conclusion

Phase 3 Sprint 3.3 successfully updated translation source files (.ts) and documented the translation workflow. While .qm compilation was not completed due to system tool configuration, the translation files are ready for future use.

**Key Achievements**:
- ✅ Translation files updated to current code
- ✅ New strings extracted and translated
- ✅ Translation workflow documented
- ✅ Foundation ready for full i18n implementation

**Recommendation**: Translation expansion is low priority for current version. Focus on core functionality first, then implement comprehensive i18n in future releases when targeting international users.

---

**Phase 3 Sprint 3.3 completed successfully** ✅
**Translation files updated** ✅
**Workflow documented** ✅
**Ready for future expansion** ✅
